{% set chatrooms = __SELF__.chatrooms %}

<!-- Chat ============================================================ -->
<section class="chat">
    <div class="auto_container">
        <div class="chat_wrap">
            <div class="chat_box">
                <div class="chat_people">

                    {% for chatroom in chatrooms %}
                    <a href="#" class="person" style="display: block;"
                        data-request="onChatroom"
                        data-request-data="chatroom_id: {{chatroom.id}}"
                        data-request-success="showMessages(data)"
                        data-id="{{ chatroom.id}}"
                        data-partner-id="{{ chatroom.message_partner.id }}"
                    >
                        <div class="person_name">

                            {% if chatroom.message_partner.name or chatroom.message_partner.surname %}
                                {{chatroom.message_partner.name}} {{chatroom.message_partner.surname}}
                            {% else %}
                                {{chatroom.message_partner.email}}
                            {% endif %}
                            
                            &nbsp;
                            <span class="unread-messages-count">
                                {% if chatroom.count_unread_messages %}
                                    ({{chatroom.count_unread_messages}})
                                {% endif %}
                            </span>
                        </div>
                        <div class="person_message">
                            {{chatroom.last_message.message}}
                        </div>
                    </a>
                    {% endfor %}
                    
                </div>
                <div class="chat_area" id="chatroom">

                    <!-- chat_area -->

                </div>
            </div>
        </div>
    </div>
</section>
<!-- Chat end ======================================================== -->

{% put scripts %}
    <script>
        function showMessages(data) {

            $('#chatroom').html(data.chat_area);
            
            var bottom= $('.chat_area-inner').height()+$('.chat_area-inner').prop('scrollHeight');    
            $('.chat_area-inner').scrollTop(bottom);

            $('.unread-messages-count').text('');
        }
    </script>
{% endput %}
